<!DOCTYPE html>
<html lang="en" ok>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta name="nova-icon" content="<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' width='50.30714' height='42.85066' viewBox='0,0,50.30714,42.85066'><defs><radialGradient cx='229.95714' cy='164.1' r='23.7' gradientUnits='userSpaceOnUse' id='color-1'><stop offset='0' stop-color='#757575'/><stop offset='1' stop-color='#141414'/></radialGradient><radialGradient cx='230.5' cy='169.5' r='16.50065' gradientUnits='userSpaceOnUse' id='color-2'><stop offset='0' stop-color='#767676'/><stop offset='1' stop-color='#101010'/></radialGradient><linearGradient x1='229.74699' y1='167.07229' x2='250.25302' y2='192.92771' gradientUnits='userSpaceOnUse' id='color-3'><stop offset='0' stop-color='#adadad'/><stop offset='1' stop-color='#4f4f4f'/></linearGradient><linearGradient x1='231.88667' y1='170.66349' x2='236.03347' y2='174.99986' gradientUnits='userSpaceOnUse' id='color-4'><stop offset='0' stop-color='#adadad'/><stop offset='1' stop-color='#4f4f4f'/></linearGradient><radialGradient cx='254.85714' cy='163.65595' r='5.14286' gradientUnits='userSpaceOnUse' id='color-5'><stop offset='0' stop-color='#000000' stop-opacity='0'/><stop offset='1' stop-color='#000000' stop-opacity='0'/></radialGradient></defs><g transform='translate(-217.5,-154.9)'><g data-paper-data='{&quot;isPaintingLayer&quot;:true}' fill-rule='nonzero' stroke-linecap='butt' stroke-linejoin='miter' stroke-miterlimit='10' stroke-dasharray='' stroke-dashoffset='0' style='mix-blend-mode: normal'><path d='M219.15714,194.8v-29.6h47.4v29.6z' fill='#141414' stroke='url(#1f1f1f)' stroke-width='2.5'/><path d='M224.125,180c0,-8.76752 7.10748,-15.875 15.875,-15.875c8.76752,0 15.875,7.10748 15.875,15.875c0,8.76752 -7.10748,15.875 -15.875,15.875c-8.76752,0 -15.875,-7.10748 -15.875,-15.875z' fill-opacity='0.17647' fill='#000000' stroke='none' stroke-width='2.5'/><path d='M227.07229,190.25302c-5.66259,-7.13978 -4.46509,-17.51814 2.67469,-23.18072c7.13978,-5.66259 17.51814,-4.46509 23.18072,2.67469c5.66258,7.13978 4.46508,17.51814 -2.67469,23.18072c-7.13978,5.66259 -17.51814,4.46509 -23.18072,-2.67469z' data-paper-data='{&quot;index&quot;:null}' fill='url(#color-2)' stroke='url(#color-3)' stroke-width='2.5'/><path d='M235.2,180c0,-2.65097 2.14903,-4.8 4.8,-4.8c2.65097,0 4.8,2.14903 4.8,4.8c0,2.65097 -2.14903,4.8 -4.8,4.8c-2.65097,0 -4.8,-2.14903 -4.8,-4.8z' fill='#161616' stroke='#323232' stroke-width='2.5'/><path d='M217.5,154.9v0v0v0z' fill='#161616' stroke='#323232' stroke-width='2.5'/><path d='M231.22001,170.24683c2.67889,-2.67639 7.31361,-2.68561 7.31361,-2.68561c0,0 -3.24739,1.53752 -5.59341,4.11871c-2.50625,2.75747 -4.90715,7.30886 -4.90715,7.30886c0,0 0.05589,-5.61382 3.18696,-8.74196z' fill-opacity='0.57255' fill='#ffffff' stroke='url(#color-4)' stroke-width='0'/><path d='M249.71429,165.65595v-4h10.28571v4z' fill='#141414' stroke='url(#color-5)' stroke-width='0'/><path d='M260.85714,188.65595v-17.28571h3.57143v17.28571z' fill='#b6b6b6' stroke='#303030' stroke-width='1.5'/></g></g></svg>">
  <title>Camera App</title>
  <style>
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 0;
		background-color: black;
    }

    #video-container {
      position: relative;
    }

    #video {
      height: 100%;
      max-width: 95vw;
      border-radius: 8px;
      transform: scaleX(1); /* Initial scaling without mirroring */
      transition: 0.3s ease-in-out;
    }

    #camera-select {
      position: absolute;
      top: 10px;
      right: 10px;
		background-color: #1f1f1f;
		color: grey;
		border: none;
		padding: 5px;
		border-radius: 5px;
    }

    #mirror-btn {
      position: absolute;
      bottom: 10px;
      left: 10px;
      padding: 8px;
      background-color: #1f1f1f;
      color: #fff;
      border: none;
      border-radius: 50%;
      cursor: pointer;
    }

	  #photo-btn {
		  position: fixed;
		  bottom: 5%;
		  border: cornsilk;
		  height: 15%;
		  aspect-ratio: 1/1;
		  border-radius: 50%;
		  opacity: 75%;
		  box-shadow: 0 0 20px black;
	  }

	  #photo-btn:active {
		  transform: scale(0.9);
	  }
  </style>
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<body>
  <div id="video-container">
    <video id="video" playsinline autoplay></video>
    
  </div>
	<select id="camera-select"></select>
	<button id="mirror-btn" onclick="toggleMirror()"><span class="material-icons">
	360
	</span></button>
	<button id="photo-btn" onclick="capture(this)"><span class="material-icons">
	camera
	</span></button>

  <script>
    let isMirrored = false;

    async function getVideoSources() {
      const devices = await navigator.mediaDevices.enumerateDevices();
      const cameras = devices.filter(device => device.kind === 'videoinput');
      return cameras;
    }

	  async function startCamera() {
		const video = document.getElementById('video');
		const cameras = await getVideoSources();
		const cameraSelect = document.getElementById('camera-select');

		if (cameras.length === 0) {
		  console.error('No cameras found.');
		  return;
		}

		cameras.forEach(camera => {
		  const option = document.createElement('option');
		  option.value = camera.deviceId;
		  option.text = camera.label || `Camera ${cameraSelect.length + 1}`;
		  cameraSelect.appendChild(option);
		});

		cameraSelect.addEventListener('change', async () => {
		  const selectedCameraId = cameraSelect.value;
		  try {
			const stream = await navigator.mediaDevices.getUserMedia({ video: { deviceId: selectedCameraId } });
			video.srcObject = stream;
			resetMirror();
		  } catch (error) {
			console.error('Error accessing camera:', error);
		  }
		});

		const defaultCameraId = cameras[0].deviceId;
		try {
		  const stream = await navigator.mediaDevices.getUserMedia({ video: { deviceId: defaultCameraId } });
		  video.srcObject = stream;
		} catch (error) {
		  console.error('Error accessing default camera:', error);
			let x = await  window.parent.justConfirm("Can't Get Camera", "Your device seem to say that there's no camera, Should we try again harder?");
			if (x) {
				startCamera();
			}
		}
	  }

    function toggleMirror() {
      const video = document.getElementById('video');
      isMirrored = !isMirrored;
      video.style.transform = `scaleX(${isMirrored ? -1 : 1})`;
    }

    function resetMirror() {
      const video = document.getElementById('video');
      isMirrored = false;
      video.style.transform = 'scaleX(1)';
    }

	  function greenflag() {
		  startCamera()
	  }

	  function captureCameraImage() {
		  const video = document.getElementById('video');
		  const canvas = document.createElement('canvas');
		  const ctx = canvas.getContext('2d');

		  // Set canvas dimensions to match video dimensions
		  canvas.width = video.videoWidth;
		  canvas.height = video.videoHeight;

		  // Apply mirror effect if needed
		  if (isMirrored) {
			  ctx.translate(canvas.width, 0);
			  ctx.scale(-1, 1);
		  }

		  // Draw video frame onto canvas
		  ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

		  // Convert canvas content to base64-encoded PNG
		  
		  const dataUrl = canvas.toDataURL('image/png');

		  return dataUrl;
	  }

	  function capture(obj) {
		  const video = document.getElementById('video');
		  video.style.filter = "brightness(5)"
		  let cakebuff = obj.innerHTML;
		  obj.innerHTML = "..."
		  let x = captureCameraImage();
		  x = window.parent.shrinkbsf(x);
		  let y = {
			  "via":"camera"
		  }
		  window.parent.createFile("Media", "captured", "image/png", x, y)
		  obj.innerHTML = cakebuff;
		  setTimeout(() => {
			  video.style.filter = "none";
		  }, 500);
		  
	  }
  </script>
</body>
</html>
